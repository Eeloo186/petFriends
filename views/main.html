<!DOCTYPE html>
<html lang="en">
  <head>
    {% include 'head.html' %}
  </head>
  <body>
    {% include 'top.html' %}
    <h1>메인 페이지</h1>
    {% for twit in twits %}
    <h3>게시글번호 : {{twit.id}} // 작성자ID : {{twit.User.userId}} // 작성자닉네임 : {{twit.User.nickname}} // 작성일 : {{twit.createdAt}}</h3>
    {% endfor %}

    <!-- 카카오 지도 테스트 시작 -->
    <div id="map" style="width: 500px; height: 400px"></div>
  </body>
  <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=ec69be90b3acf84ca69f8f6636ad3463&libraries=services"></script>
  <script>
    // 로그인한 유저의 주소를 지도의 중심좌표로 설정

    // 주소-좌표 변환 객체를 생성합니다
    let geocoder = new kakao.maps.services.Geocoder();
    // let defaultAddress = "서울특별시 강남구 역삼동 858";
    let defaultAddress = "대구광역시 서구 평리동 1360번지";


    // 주소로 좌표를 검색합니다
    geocoder.addressSearch("{{user.address2}}" ? "{{user.address2}}" : defaultAddress, function (result, status) {
      // 정상적으로 검색이 완료됐으면
      if (status === kakao.maps.services.Status.OK) {
        let coords = new kakao.maps.LatLng(result[0].y, result[0].x); // 좌표 구함
        let mapContainer = document.getElementById("map"); // 지도를 표시할 div
        mapOption = {
          center: new kakao.maps.LatLng(coords.getLat(), coords.getLng()), // 지도의 중심좌표를 로그인한 유저의 주소로 설정
          level: 9, // 지도의 확대 레벨
        };
        let map = new kakao.maps.Map(mapContainer, mapOption);

        // DB에서 동물병원 목록 받아옴
        axios
          .get("/api/hospitals")
          .then((res) => {
            // res.data.length
            // res.data.forEach

            const markerList = [];
            res.data.forEach((hospital) => {
              geocoder.addressSearch(hospital.location, function (result, status) {
                console.log(hospital.location);
                let coords = new kakao.maps.LatLng(result[0].y, result[0].x); // 동물병원 주소로 좌표 구함
                const marker = new kakao.maps.Marker({
                  position: coords,
                });
                marker.setMap(map);
              });
            });
          })
          .catch((err) => {
            console.error(err);
          });
      }
    });
  </script>
  <!-- 카카오 지도 테스트 끝 -->
</html>
